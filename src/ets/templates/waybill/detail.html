{% extends "base_template.html" %}
{% load i18n extra_tags %}

{% block title %}{{ object }}{% endblock %}

{% block style %}
{{ block.super }}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/waybill.css" media="screen"/>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/print.css" media="print" />
{% endblock %}

{% block content %}

<div class="hidden_print actions">
    
  {% waybill_edit object user %}
  {% waybill_reception object user %}

  <button class="print_copy">Print Copy</button>
  
  {% validate_dispatch object user %}
  {% validate_receipt object user %}
  
  {% sign_dispatch object user as may_sign_dispatch %}
  {% if may_sign_dispatch %}
  <form method="POST" action="{% url waybill_finalize_dispatch waybill_pk=object.pk %}">
    <input class="print_original" type="submit" name="print_original" value="Sign dispatch" />
  </form>
  {% endif %}
  
  {% sign_reception object user as may_sign_reception %}
  {% if may_sign_reception %}
  <form method="POST" action="{% url waybill_finalize_receipt waybill_pk=object.pk %}">
    <input class="print_original" type="submit" name="print_original" value="Sign reception" />
  </form>
  {% endif %}

  {% waybill_delete object user _('Delete') object.order.get_absolute_url %}
</div>

<table id="details" cellpadding="0" cellspacing="0" border="0px" >
  {% include 'waybill/print/wb_header.html' %}
  {% include 'waybill/print/wb_loading.html' %}
  {% include 'waybill/print/wb_receipt.html' %}
</table>

<div id="sidebar" class="hidden_print">
  <h3>{% trans "Waybill history" %}</h3>
  {% include "waybill/history_fragment.html" with history_list=waybill_history %}
  
  <h3>{% trans "Loading details history" %}</h3>
  
  {% for loading, history in loading_detail_history %}
  <h4>{{ loading.stock_item.coi_code }} - {{ loading.stock_item.commodity }}</h4>
  {% include "waybill/history_fragment.html" with history_list=history %}
  {% endfor %}
</div>
{% endblock %}

{% block script %}
{{ block.super }}
<script charset="utf-8">
  $(document).ready(function() {
    $('.print_copy').click(function(){
    	$("#original_lable").addClass('hidden').removeClass('shown');
    	$("#copy_lable").addClass('shown').removeClass('hidden');
    	print();
    	return false;
    });
    
    $('.print_original').click(function() {
      $("#original_lable").addClass('shown').removeClass('hidden');
      $("#copy_lable").addClass('hidden').removeClass('shown');
      print();
      $("#original_lable").addClass('hidden').removeClass('shown');
      $("#copy_lable").addClass('shown').removeClass('hidden');
    });
    
  });
</script>
{% endblock %}
